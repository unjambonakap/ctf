#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>

#include "rijndael.h"

unsigned char cipher[]={0x40, 0x40, 0xa9, 0x8a, 0xd1, 0xae, 0x25, 0xdf, 0x8b, 0xe9, 
	0x7d, 0xf6, 0x5f, 0x90, 0xa9, 0x80, 0x97, 0xf3, 0x95, 0x80,
	0xe4, 0x11, 0x65, 0x55, 0x0a, 0xdc, 0xf8, 0x29, 0x41, 0x7b, 
	0x00, 0x2c, 0x0f, 0x81, 0xb3, 0xb1, 0xbc, 0xdc, 0x83, 0x91, 
	0x1e, 0x06, 0x52, 0xd8, 0xa9, 0x28, 0x04, 0x35, 0x41, 0x6a,
	0x33, 0x2f, 0x7a, 0x3f, 0x8b, 0x34, 0x91, 0x24, 0x9b, 0x3b,
	0x66, 0x96, 0x25, 0x0c, 0x4c, 0x24, 0x36, 0xe6, 0x62, 0x1d, 
	0x0c, 0xf2, 0x38, 0x2b, 0x2d, 0x7e, 0x24, 0x8f, 0x08, 0x76, 
	0x92, 0xd0, 0x6a, 0xeb, 0x23, 0x29, 0x1b, 0x47, 0x96, 0x24, 
	0x45, 0xcd, 0x76, 0x47, 0x99, 0xdf, 0x49, 0x7c, 0xf2, 0xc3, 
	0xcc, 0x02, 0xd1, 0xbe, 0xb7, 0xe1, 0xae, 0xed, 0xe6, 0x82, 
	0x37, 0x30, 0xc3, 0xd2, 0x92, 0x08, 0x0f, 0xde, 0xa5, 0x21, 
	0xd9, 0x8b, 0xf8, 0xde, 0x60, 0x7c, 0x0e, 0x29};

//const char *cset="azertqsdfgwxcv12345";
const char *cset="qwertasdfgzxcvb12345";
const char *plains="674e2";
const char *ps="wcwteseawx";
int npl=4;
int nps=10;
int cl=20;
#define ks 16

const int nt=1;
int id;

void bf(){
	unsigned char tb[ks+1], res[ks+1], tba[ks];
	unsigned long buf[RKLENGTH(ks*8)];
	int pos=nps, i, j;
	for (i=0; i<nps; ++i) tb[i]=ps[i];
	for (i=nps; i<ks; ++i) tb[i]=cset[0];

	tb[ks]=0;
	memset(tba, 0, sizeof(char)*ks);
	tba[nps]=id;
	res[ks]=0;
	while(1){
		pos=ks-1;
		//for (i=nps; i<ks; ++i) printf("%d ", tba[i]); printf("\n");
		rijndaelSetupDecrypt(buf, tb, ks*8);
		for (i=0; i<sizeof(cipher)/ks; ++i){
			rijndaelDecrypt(buf, NROUNDS(ks*8), cipher+i*16, res);
			for (j=0; i==0 && j<npl; ++j) if (res[j]!=plains[j]) goto fail;
			printf("%s", res);
		}
		printf("<<<<<<%s\n", tb);

fail:
		while(tba[pos]+1>=cl && pos>nps) tb[pos]=cset[tba[pos]=0], --pos;
		tb[pos]=cset[tba[pos]+=(pos==cl?nt:1)];
		if (tba[pos]>=cl)return;//end of bf
	}

}

int main(){

	int i;
	id=nt;


	for (i=0; i<nt && id==nt; ++i) if (fork()) id=i;
	if (id!=nt){ bf(); return 0;}
	int s;
	for (i=0; i<nt; ++i) wait(&s);
	printf("END OF BRUTEFORCE\n");
	return 0;
}



