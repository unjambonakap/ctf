#include <sys/syscall.h>
# define ASMFMT_1(arg1) \
	, "b" (arg1)
# define ASMFMT_2(arg1, arg2) \
	, "b" (arg1), "c" (arg2)
# define ASMFMT_3(arg1, arg2, arg3) \
	, "b" (arg1), "c" (arg2), "d" (arg3)
# define ASMFMT_4(arg1, arg2, arg3, arg4) \
	, "b" (arg1), "c" (arg2), "d" (arg3), "S" (arg4)
# define ASMFMT_5(arg1, arg2, arg3, arg4, arg5) \
	, "b" (arg1), "c" (arg2), "d" (arg3), "S" (arg4), "D" (arg5)
# define LOADARGS_0
# define LOADARGS_1
# define LOADARGS_2
# define LOADARGS_3
# define LOADARGS_4
# define LOADARGS_5
#define EXTRAVAR_0
#define EXTRAVAR_1
#define EXTRAVAR_2
#define EXTRAVAR_3
#define EXTRAVAR_4
#ifdef __PIC__
# define EXTRAVAR_5 int _xv;
#else
# define EXTRAVAR_5
#endif
# define RESTOREARGS_1
# define RESTOREARGS_2
# define RESTOREARGS_3
# define RESTOREARGS_4
# define RESTOREARGS_5
# define INTERNAL_SYSCALL(name, err, nr, args...) \
    ({                                          \
     register unsigned int resultvar;                       \
     EXTRAVAR_##nr                                  \
     asm volatile (                                 \
             LOADARGS_##nr                                  \
             "movl %1, %%eax\n\t"                           \
             "int $0x80\n\t"                                \
             RESTOREARGS_##nr                               \
             : "=a" (resultvar)                                 \
             : "i" (__NR_##name) ASMFMT_##nr(args) : "memory", "cc");           \
     (int) resultvar; })

int main(int argc, char** argv){
    const char* file="/bin/bash";
    char** tb={file, 0};
    INTERNAL_SYSCALL(execve, ,3, file, argv, 0);
    return 0;
}
